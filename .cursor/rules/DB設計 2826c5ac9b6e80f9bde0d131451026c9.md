# DB設計

- - ============================================
-- ポートフォリオサイト データベース設計
-- ============================================
- - ユーザー/プロフィール情報
CREATE TABLE users (
id INT PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(100) NOT NULL COMMENT '氏名',
name_kana VARCHAR(100) COMMENT 'ふりがな',
email VARCHAR(255) UNIQUE NOT NULL COMMENT 'メールアドレス（ログイン用）',
password VARCHAR(255) NOT NULL COMMENT 'パスワード（ハッシュ化）',
remember_token VARCHAR(100) COMMENT 'ログイン状態保持トークン',
profile_image VARCHAR(255) COMMENT 'プロフィール画像URL',
location VARCHAR(100) COMMENT '所在地',
github_url VARCHAR(255) COMMENT 'GitHub URL',
instagram_url VARCHAR(255) COMMENT 'Instagram URL',
bio TEXT COMMENT '自己紹介文',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT='ユーザープロフィール';
- - スキルカテゴリ
CREATE TABLE skill_categories (
id INT PRIMARY KEY AUTO_INCREMENT,
user_id INT NOT NULL,
name VARCHAR(100) NOT NULL COMMENT 'カテゴリ名（例：フロントエンド、バックエンド）',
display_order INT DEFAULT 0 COMMENT '表示順序',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) COMMENT='スキルカテゴリ';
- - スキル
CREATE TABLE skills (
id INT PRIMARY KEY AUTO_INCREMENT,
category_id INT NOT NULL,
name VARCHAR(100) NOT NULL COMMENT 'スキル名（例：JavaScript, React）',
skill_level VARCHAR(50) COMMENT 'スキルレベル（例：１、２、３　5段階評価）',
experience_years DECIMAL(3,1) COMMENT '経験年数',
description TEXT COMMENT '詳細説明',
display_order INT DEFAULT 0 COMMENT '表示順序',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (category_id) REFERENCES skill_categories(id) ON DELETE CASCADE
) COMMENT='スキル詳細';
- - ワーク/作品カテゴリ
CREATE TABLE work_categories (
id INT PRIMARY KEY AUTO_INCREMENT,
user_id INT NOT NULL,
name VARCHAR(100) NOT NULL COMMENT 'カテゴリ名（例：個人、業務）',
display_order INT DEFAULT 0,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) COMMENT='作品カテゴリ';
- - ワーク/作品
CREATE TABLE works (
id INT PRIMARY KEY AUTO_INCREMENT,
user_id INT NOT NULL,
category_id INT,
title VARCHAR(200) NOT NULL COMMENT 'サムネイルタイトル',
thumbnail_image VARCHAR(255) COMMENT 'サムネイル画像URL',
featured_image VARCHAR(255) COMMENT 'サムネイル追加画像URL',
description TEXT COMMENT '概要',
technologies_used TEXT COMMENT '使用技術',
project_url VARCHAR(255) COMMENT 'プロジェクトURL',
repository_url VARCHAR(255) COMMENT 'リポジトリURL',
display_order INT DEFAULT 0,
is_published BOOLEAN DEFAULT TRUE COMMENT '公開状態',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
FOREIGN KEY (category_id) REFERENCES work_categories(id) ON DELETE SET NULL
) COMMENT='作品一覧';
- - 問い合わせ
CREATE TABLE inquiries (
id INT PRIMARY KEY AUTO_INCREMENT,
user_id INT NOT NULL,
sender_name VARCHAR(100) NOT NULL COMMENT '送信者氏名',
sender_email VARCHAR(255) NOT NULL COMMENT '送信者メールアドレス',
subject VARCHAR(200) COMMENT '件名',
message TEXT NOT NULL COMMENT 'お問い合わせ内容',
status ENUM('未読', '既読') DEFAULT '未読' COMMENT 'ステータス',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) COMMENT='問い合わせ管理';
- - 管理画面用：お知らせ/投稿
-- (削除済み)
- - SNSリンク
CREATE TABLE sns_links (
id INT PRIMARY KEY AUTO_INCREMENT,
user_id INT NOT NULL,
platform VARCHAR(50) NOT NULL COMMENT 'SNS名（GitHub, Instagram等）',
url VARCHAR(255) NOT NULL COMMENT 'SNS URL',
display_order INT DEFAULT 0,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) COMMENT='SNSリンク管理';
- - ============================================
-- インデックス定義
-- ============================================

CREATE INDEX idx_skills_category ON skills(category_id);
CREATE INDEX idx_skills_order ON skills(display_order);
CREATE INDEX idx_works_user ON works(user_id);
CREATE INDEX idx_works_category ON works(category_id);
CREATE INDEX idx_works_published ON works(is_published);
CREATE INDEX idx_inquiries_status ON inquiries(status);
CREATE INDEX idx_inquiries_created ON inquiries(created_at);

- - ============================================
-- ER図の説明（テキスト形式）
-- ============================================

/*
リレーション概要:

1. users (1) ←→ (N) skill_categories
    - 1人のユーザーは複数のスキルカテゴリを持つ
2. skill_categories (1) ←→ (N) skills
    - 1つのカテゴリは複数のスキルを持つ
3. users (1) ←→ (N) work_categories
    - 1人のユーザーは複数の作品カテゴリを持つ
4. work_categories (1) ←→ (N) works
    - 1つのカテゴリは複数の作品を持つ
5. users (1) ←→ (N) works
    - 1人のユーザーは複数の作品を持つ
6. users (1) ←→ (N) inquiries
    - 1人のユーザーは複数の問い合わせを受ける
7. users (1) ←→ (N) sns_links
    - 1人のユーザーは複数のSNSリンクを持つ

主要な制約:

- ON DELETE CASCADE: 親レコード削除時に子レコードも削除
- ON DELETE SET NULL: 親レコード削除時に外部キーをNULLに設定
*/
- - ============================================
-- サンプルデータ投入
-- ============================================

INSERT INTO users (name, name_kana, location)
VALUES ('前田 聖太', 'まえだ せいた', '東京');

INSERT INTO skill_categories (user_id, name, display_order) VALUES
(1, 'フロントエンド', 1),
(1, 'バックエンド/サーバー', 2),
(1, '環境構築など', 3),
(1, '開発ツール', 4),
(1, 'ソフトスキル', 5);

INSERT INTO skills (category_id, name, skill_level, display_order) VALUES
(1, 'JavaScript/React/TypeScript', '初級', 1),
(1, 'HTML/CSS', '中級', 2),
(2, 'PHP/Laravel', '中級', 1),
(3, 'Docker', '中級', 1);

INSERT INTO work_categories (user_id, name, display_order) VALUES
(1, '個人', 1),
(1, '業務', 2);

INSERT INTO works (user_id, category_id, title, display_order) VALUES
(1, 1, 'サムネイル画像', 1),
(1, 1, 'サムネイル画像', 2);